name: flutter_wigilabs_sr_workspace
publish_to: "none"

environment:
  sdk: ^3.8.0

workspace:
  - apps/app
  - packages/core
  - packages/design_system
  - packages/features/home
  - packages/features/wishlist
  - packages/features/settings

dev_dependencies:
  melos: ^7.4.0

melos:
  repository: https://github.com/elkisrovira/flutter_wigilabs_sr

  command:
    bootstrap:
      hooks:
        post: echo "‚úÖ Bootstrap completado. Ejecuta 'melos run build:all' para generar c√≥digo."

    version:
      workspaceChangelog: true
      linkToCommits: true
      commitMessage: "chore(release): version bump üöÄ"

  scripts:
    analyze:
      exec: dart analyze .
      concurrency: 4
      description: Analiza todos los packages.

    analyze:changed:
      exec: dart analyze .
      concurrency: 4
      packageFilters:
        diff: origin/main
      description: Analiza solo los packages que cambiaron respecto a main.

    format:
      exec: dart format --set-exit-if-changed .
      concurrency: 4
      description: Verifica el formato de todos los packages.

    format:fix:
      exec: dart format .
      concurrency: 4
      description: Aplica formato a todos los packages.

    build:all:
      run: melos run build:core && melos run build:feature_home && melos run build:feature_wishlist && melos run build:app
      description: Genera c√≥digo en todos los packages en orden secuencial.

    build:core:
      exec: dart run build_runner build --delete-conflicting-outputs
      packageFilters:
        scope: core
      description: Genera c√≥digo en el package core (drift, injectable, freezed).

    build:feature_home:
      exec: dart run build_runner build --delete-conflicting-outputs
      packageFilters:
        scope: feature_home
      description: Genera c√≥digo en feature_home.

    build:feature_wishlist:
      exec: dart run build_runner build --delete-conflicting-outputs
      packageFilters:
        scope: feature_wishlist
      description: Genera c√≥digo en feature_wishlist (depende de feature_home).

    build:app:
      exec: dart run build_runner build --delete-conflicting-outputs
      packageFilters:
        scope: flutter_wigilabs_sr
      description: Genera c√≥digo en la app principal.

    build:watch:
      exec: dart run build_runner watch --delete-conflicting-outputs
      packageFilters:
        dependsOn: build_runner
      description: Inicia build_runner en modo watch en todos los packages.

    clean:generated:
      exec: find . -name "*.g.dart" -o -name "*.freezed.dart" -delete
      description: Elimina todos los archivos generados.

    test:
      exec: flutter test
      concurrency: 4
      description: Ejecuta todos los tests.

    test:coverage:
      exec: flutter test --coverage
      concurrency: 1
      description: Ejecuta todos los tests con reporte de cobertura.

    test:changed:
      exec: flutter test
      concurrency: 4
      packageFilters:
        diff: origin/main
      description: Ejecuta tests solo de los packages que cambiaron.

    run:mobile:
      run: cd $MELOS_ROOT_PATH/apps/app && flutter run
      description: Lanza la app en el simulador o dispositivo m√≥vil.

    run:web:
      run: cd $MELOS_ROOT_PATH/apps/app && flutter run -d chrome --web-port 4000
      description: Lanza la app en Chrome.

    run:desktop:
      run: cd $MELOS_ROOT_PATH/apps/app && flutter run -d macos
      description: Lanza la app en macOS Desktop.

    ci:
      run: melos run analyze && melos run format && melos run test
      description: Pipeline completo de CI.
